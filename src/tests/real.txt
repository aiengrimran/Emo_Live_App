import {View, Text, Button, StyleSheet} from 'react-native';
import React, {useState} from 'react';
import echo from '../utils/echo';
import {io} from 'socket.io-client';

export default function RealTime() {
  const [letChannel, setLetChannel] = useState<any>('');
  const connect = () => {
    try {
      // Replace with your Laravel Reverb WebSocket URL
      const socket = io('ws://192.168.10.3:8080/app/xjceygqczxvyasqh0c2d', {
        transports: ['websocket'], // Force WebSocket
        // auth: {
        //   key: 'xjceygqczxvyasqh0c2d', // Use your Reverb App Key
        // },
      });
      // Log connection status
      socket.on('connect', () => {
        console.log('Connected to Reverb WebSocket!');
      });

      // Subscribe to a channel
      socket.emit('pusher:subscribe', {
        auth: '',
        channel: 'chat-channel',
      });
      socket.on('connect_error', error => {
        console.error('Connection error:', error);
      });

      // Listen for messages
      socket.on('ChatMessage', data => {
        console.log('Received message:', data);
      });

      console.log(socket);
      // echo.channel('chat-channel').listen('.ChatMessage', (e: any) => {
      //   console.log('New Message:', e);
      //   // setMessages((prev) => [...prev, e.message]);
      // });
    } catch (error) {
      console.log(error);
    }
  };
  const latConnect = () => {
    try {
      const socket = io('ws://localhost:8080', {
        transports: ['websocket'], // Use WebSocket transport
      });
      socket.on('connect', () => {
        console.log('Connected to Laravel Reverb WebSocket');
      });
    } catch (error) {
      console.log(error, 'ss');
    }
  };

  return (
    <View style={styles.container}>
      <Text>RealTime</Text>
      <Button title="connect" onPress={connect} />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
});
